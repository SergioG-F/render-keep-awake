name: Keep Render Backend Awake

# ğŸš€ PROGRAMACIÃ“N:
# Ejecuta el workflow cada 5 minutos durante JULIO 7, AGOSTO (8) y SEPTIEMBRE (9),
# y hace un Ãºltimo ping el 30 de septiembre a las 23:59 (UTC)
on:
  schedule:
    - cron: '*/5 * * 7-9 *'      # â±ï¸ Cada 5 minutos en Julio, agosto y septiembre
    - cron: '59 23 30 9 *'       # ğŸ›Œ Ãšltimo ping el 30 de septiembre

  workflow_dispatch:             # â–¶ï¸ Permite ejecuciÃ³n manual

jobs:
  ping-render:
    name: ğŸŒ Ping al backend en Render
    runs-on: ubuntu-latest
    steps:
      - name: â° Ejecutando ping a Render backend
        run: |
          TIMESTAMP=$(date -u +"%Y-%m-%d %H:%M:%S")
          echo "ğŸ“¡ Ping enviado a las $TIMESTAMP UTC"
          RESPONSE=$(curl -s -o /dev/null -w "%{http_code}" https://reception-back.onrender.com/)
          echo "ğŸ“¥ CÃ³digo de respuesta: $RESPONSE"
          if [ "$RESPONSE" != "200" ]; then
            echo "âš ï¸ Backend no respondiÃ³ correctamente o estÃ¡ dormido"
          fi

  despedida:
    name: ğŸ›Œ Ãšltimo ping del ciclo (despedida simbÃ³lica)
    if: github.event.schedule == '59 23 30 9 *'
    runs-on: ubuntu-latest
    steps:
      - name: âœ… Ãšltimo ping enviado. Tu backend puede descansar ğŸ˜´
        run: echo "ğŸ›‘ Fin del ciclo: backend puede dormir a partir de ahora."

  auto-disable:
    name: ğŸš« Autodesactivar GitHub Action (borrar este archivo)
    if: github.event.schedule == '59 23 30 9 *'
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: ğŸ”§ Clonar el repositorio
        uses: actions/checkout@v4

      - name: ğŸ—‘ï¸ Eliminar archivo keep-alive.yml
        run: |
          echo "Borrando este workflow para detener futuros pings..."
          rm -f .github/workflows/keep-alive.yml

      - name: ğŸ“¤ Commit y push del borrado
        run: |
          git config --global user.name "uptime-bot"
          git config --global user.email "uptime@githubactions.com"
          git add .github/workflows/keep-alive.yml || echo "Ya estaba borrado"
          git commit -m "ğŸ›‘ Autoapagado: Fin del ciclo de pings a Render (sept 30)"
          git push
